# Домашнее задание к занятию 13 «Введение в мониторинг»

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. 
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

#### Решение

Опираясь на приведенные наборы метрик, следует мониторить:

**Latency** - время отклика HTTP-запросов пользователей, а также задержку read/write операций на диске.

**Traffic** - количество запросов к компоненту. Для веб-сервера это могут http-запросы, для базы данных — транзакции и т.д.

**Errors** - частоту ошибок или количество ошибок. Это могут быть некорректные коды ответа, исключения в приложении и т.д.

**Utilization** - время или процент использования ресурса, занятого «полезной работой» (CPU, RAM, HDD, FS, inodes), чтобы отслеживать состояние дисков и нагрузку на ЦПУ и другие ресурсы при вычислениях.

**Saturation** - вводится для ситуации, когда utilization 100 % и работа откладывается в очередь. Например, большое количество http-запросов единовременно, отложенные вычисления в БД.
#

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

#### Решение
Требуется отслеживать следующие показатели:

**SLI (Service level indicators)** — набор ключевых метрик, по которым можно определить жизненный статус сервиса, его производительность, «удовлетворенность» конечных пользователей работой сервиса.

**SLA (Service level agreement)** — так называемое «соглашение об уровне доступности сервиса», которое определяется как внешнее обязательство перед конечным пользователем или клиентом.

**SLO (Service level objectives)** — набор целевых, «желаемых» значений SLI, выход за пределы которых может привести к нарушению SLA конкретного сервиса или компонента. Максимально допустимое отклонение от «идеальных» показателей в данной концепции называется Error Budget (право на ошибку).

**MTBF** (средняя наработка на отказ) — это среднее время между исправляемыми сбоями технологического продукта.

**MTTR** (среднее время восстановления или среднее время стабилизации) — это среднее время восстановления после сбоя работы продукта или системы.

#

3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

#### Решение
Отсутствие системы мониторинга несет риски в первую очередь для бизнеса, т.к. при отсутствии данных от объектов управления невозможно оценить состояние ключевых показателей. Для организации комплексной системы мониторинга можно использовать Grafana-стек, либо ELK+Prometheus+Grafana, TICK.  

Но если мы не можем добавить дополнительных инструментов,то разработчики могут попробовать направить формат логов, написать скрипт, периодически проверяющий логи за прошедший промежуток времени, выцепляющий логи с некоторым вхождением (например, все, где после времени стоит ERORR), и отправляющий их в любой доступный канал.
#

3. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. 
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

#### Решение
При расчете показателя к положительным ответам также относится редирект (3хх) и формула должна выглядеть, как ```(summ_2xx_requests + summ_3xx_requests)/(summ_all_requests)```



---
